---

---

<!-- Форма с HTML5-валидацией -->
<form class="contact-form__form" action="/submit-form" method="POST" novalidate>
  <fieldset class="contact-form__form-wrap">
    <legend class="visually-hidden">Контактная информация</legend>
    <div class="contact-form__grid">
      <div class="contact-form__col">
        <!-- Группа полей (имя, email, телефон) -->
        <div class="contact-form__form-group">
          <input class="contact-form__input" type="text" id="first-name" name="first_name" autocomplete="name" required required aria-label="Имя (обязательное поле)" placeholder="Введите ваше имя" minlength="2" maxlength="50" />
        </div>
        <div class="contact-form__form-group">
          <input class="contact-form__input" type="email" id="email" name="email" autocomplete="email" required aria-label="Email (обязательное поле)" placeholder="example@mail.com" pattern="[^@\s]+@[^@\s]+\.[^@\s]+" />
        </div>

        <div class="contact-form__form-group">
          <input class="contact-form__input" type="tel" id="phone" name="phone" autocomplete="tel" aria-label="Телефон" placeholder="+7 (XXX) XXX-XX-XX" pattern="[\+]\d{1}\s[\(]\d{3}[\)]\s\d{3}[\-]\d{2}[\-]\d{2}" />
        </div>
      </div>
      <div class="contact-form__col">
        <div class="contact-form__textarea-wrap">
          <textarea class="contact-form__textarea" id="message" name="message" rows="5" aria-label="Сообщение" placeholder="Введите ваше сообщение..." maxlength="1000"></textarea>
        </div>
      </div>
    </div>
    <!-- Чекбокс согласия (исправленная версия) -->
    <label class="contact-form__checkbox-wrap">
      <input type="checkbox" id="consent" name="consent" required checked class="visually-hidden" />
      <span class="contact-form__checkbox-icon _icon-checkbox-unchecked" aria-hidden="true"></span>
      <span class="contact-form__checkbox-label"> Согласие на обработку персональных данных* </span>
    </label>
  </fieldset>

  <!-- Кнопка отправки -->
  <div class="contact-form__footer">
    <button class="button button--filled" type="submit">Отправить</button>
  </div>
</form>

<style lang="scss">
  @use '@styles/base/mixins/rem-em' as rem-em;
  @use '@styles/base/mixins/grid.scss' as grid;

  .contact-form {
    &__form-wrap {
    }
    &__grid {
      margin-bottom: var(--space-md);
      @include grid.grid-2-columns(var(--space-grid-gap));
    }

    &__col {
      width: 100%;
      min-width: 0; /* Фикс для переполнения содержимого */
      display: flex;
      flex-direction: column;
      gap: var(--space-grid-gap);
    }
    &__form-group {
    }

    &__input,
    &__textarea {
      width: 100%;
      color: var(--md-sys-color-secondary);
      background-color: inherit;
      padding: var(--space-input) var(--space-input);
      border: 2px solid var(--md-sys-color-on-surface-variant);
      border-radius: var(--border-radius-medium);

      /* Стили для невалидных полей */
      &:not(:placeholder-shown):invalid {
        border-color: var(--md-sys-color-error);
        box-shadow: var(--box-shadow-Light-05);
      }

      &:focus {
        //border: 3px solid var(--color-border);
        background-color: color-mix(in srgb, var(--md-sys-color-primary) 10%, transparent);
        box-shadow: var(--box-shadow-Light-02);
        outline: none;
      }

      &::placeholder {
        font-family: var(--font-family-base);
        font-size: var(--font-size-lg);
      }
    }
    &__textarea-wrap {
      width: 100%;
      textarea {
        resize: none;
        height: 100%;
        min-height: 180px;
      }
    }
    /* Переработанный чекбокс */
    &__checkbox-wrap {
      min-width: 100%;
      width: 100%;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      user-select: none;
      position: relative;

      .contact-form__checkbox-icon {
        position: relative;
        &::after {
          font-family: 'icomoon';
          content: '\ea52';
          position: absolute;
          display: none;
          left: 0;
          top: -3px;
          color: var(--md-sys-color-tertiary);
        }
      }

      /* Стили для отмеченного чекбокса */
      input[type='checkbox']:checked + .contact-form__checkbox-icon {
        background-color: color-mix(in srgb, var(--md-sys-color-primary) 10%, transparent);

        &::after {
          display: block;
        }
      }

      /* Фокус-стили */
      input[type='checkbox']:focus-visible + .contact-form__checkbox-icon::after {
        color: var(--md-sys-color-primary);
      }
    }

    &__checkbox-label {
      font-size: var(--font-size-lable-medium);
    }

    &__footer {
      padding-top: var(--space-md);
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.querySelector('.contact-form__form');
    const consentCheckbox = document.getElementById('consent');
    const submitButton = form.querySelector('.button--filled');

    // Проверяем состояние чекбокса при загрузке
    updateButtonState();

    // Обновляем состояние кнопки при изменении чекбокса
    consentCheckbox.addEventListener('change', updateButtonState);

    // Дополнительная проверка при отправке формы
    form.addEventListener('submit', function (e) {
      if (!consentCheckbox.checked) {
        e.preventDefault();
        // Можно добавить визуальное уведомление
        alert('Пожалуйста, дайте согласие на обработку данных');
      }
    });

    function updateButtonState() {
      submitButton.disabled = !consentCheckbox.checked;
      submitButton.setAttribute('aria-disabled', !consentCheckbox.checked);
    }
  });

  consentCheckbox.addEventListener('change', function () {
    updateButtonState();
    if (!this.checked) {
      // Показываем подсказку около чекбокса
      const warning = document.createElement('span');
      warning.className = 'consent-warning';
      warning.textContent = 'Необходимо ваше согласие';
      this.closest('label').appendChild(warning);
    } else {
      const warning = document.querySelector('.consent-warning');
      if (warning) warning.remove();
    }
  });
</script>
