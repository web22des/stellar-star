---
layout: ../../layouts/MarkdownLayout.astro
title: "Куда попадают стили и скрипты из Astro-компонентов при сборке"

date: 2023-11-18
description: "Это пример описания поста"
---

# Куда попадают стили и скрипты из Astro-компонентов при сборке

При сборке Astro-проекта (astro build) система оптимизирует и распределяет ваш код особым образом. Вот что происходит с разными типами ресурсов:

## 1. Стили (`<style>` внутри компонента)

#### Что происходит:

-   Все CSS/SCSS из компонентов объединяются в один или несколько оптимизированных `.css`-файлов.

-   Astro автоматически удаляет неиспользуемые стили (если не указано **is:global**).

-   Классы получают уникальные хеши (например, .header → `.\_header_1a2b3c`), чтобы избежать конфликтов.

#### Где оказываются:

В итоговой сборке стили попадают в:

```txt
dist/
├── assets/
│   └── style.[hash].css       # Основной CSS-файл
└── index.html                 # Автоматически подключается
```

#### Пример:

```astro
<!-- Button.astro -->
<style>
  .btn { color: red; }
</style>
```

> Превратится в `assets/style.abc123.css` с селектором `.\_btn_x1y2z3.`

## 2. Инлайн-скрипты (`<script>` без атрибутов)

#### Что происходит:

-   Скрипты остаются в HTML как инлайн-код (если они маленькие).

-   Для больших скриптов Astro может вынести их в отдельный .js-файл.

#### Где оказываются:

-   Либо внутри `<script>` в HTML:

```html
<!-- dist/index.html -->
<script>
    console.log("Hello!");
</script>
```

-   Либо в `assets/script.[hash].js` (если код большой).

## 3. Скрипты с атрибутами (client:load, client:idle и т.д.)

#### Что происходит:

-   Скрипты выносятся в отдельные .js-файлы.

-   Загружаются по стратегии:

    -   client:load — сразу при загрузке страницы.

    -   client:idle — когда браузер простаивает.

    -   client:visible — когда компонент появляется в viewport.

#### Где оказываются:

```txt
dist/
├── assets/
│   ├── Button.[hash].js      # Отдельный JS для компонента
│   └── chunks/              # Дополнительные фрагменты кода
└── index.html
```

## 4. Скрипты из .client.js-файлов

#### Что происходит:

-   Весь код из таких файлов автоматически обрабатывается Vite (как и в dev-режиме).

-   Дерешится (tree-shaking) — удаляется неиспользуемый код.

-   Минифицируется.

#### Где оказываются:

-   В `assets/[имя-файла].[hash].js`:

```txt
dist/assets/ComplexButton.xyz789.js
```

## 5. Стили и скрипты фреймворков (React, Vue и др.)

#### Что происходит:

-   Компоненты на React/Vue/Svelte компилируются в чистый JS.

-   Их стили (если есть) добавляются в общий CSS-бандл.

-   Код разбивается на chunks для оптимизации загрузки.

#### Где оказываются:

```txt
dist/
├── assets/
│   ├── ReactButton.[hash].js    # Код компонента
│   ├── vendor.[hash].js         # Общие библиотеки (React и т.д.)
│   └── style.[hash].css         # Стили
└── index.html
```

## 6. Что насчет public/-файлов?

-   Файлы из `public/` копируются как есть без обработки:

```txt
public/fonts/ → dist/fonts/
public/robots.txt → dist/robots.txt
```

## Итог: куда что попадает

### Распределение ресурсов при сборке Astro

| Тип кода                 | Куда попадает               | Особенности обработки        |
| ------------------------ | --------------------------- | ---------------------------- |
| **Стили в компоненте**   | `assets/style.[hash].css`   | Объединяются, минифицируются |
| **Инлайн-скрипты**       | Остаются в HTML             | Не обрабатываются            |
| **client:load скрипты**  | `assets/[name].[hash].js`   | Дерешинг, минификация        |
| **React/Vue компоненты** | `assets/[name].[hash].js`   | Компиляция в JS, lazy-load   |
| **Глобальные стили**     | `assets/global.[hash].css`  | Минификация                  |
| **Файлы из public/**     | Копируются как есть         | Без обработки                |
| **Изображения**          | `assets/[name].[hash][ext]` | Оптимизация                  |

**Ключевые особенности:**

-   Хеширование имен для кеширования
-   Автоматическое объединение CSS
-   Разделение JS по стратегиям загрузки
-   Удаление неиспользуемого кода (tree-shaking)

## Как проверить на практике?

1. Запустите сборку:

```bash
astro build
```

2. Посмотрите содержимое папки `dist/`:

```bash
ls -R dist
```

3. Откройте HTML-файлы — вы увидите, как Astro подключил ресурсы. **Совет:** Используйте astro check для анализа бандла.

## Оптимизации, которые делает Astro

-   **Объединение CSS/JS** → Меньше HTTP-запросов.

-   **Хеширование имён файлов** → Кеширование в браузере.

-   **Tree-shaking** → Удаление неиспользуемого кода.

-   **Ленивая загрузка (client:idle/visible)** → Быстрая первоначальная загрузка.

Теперь вы точно знаете, куда попадает каждый ваш стиль и скрипт!
